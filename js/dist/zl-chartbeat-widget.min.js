/*! zl-chartbeat-widget 04-11-2018 */

function zlChartbeatWidget(){this.apiKey="",this.base="//api.chartbeat.com",this.data=null,this.epType="Live",this.host="",this.options={},this.path="/live/toppages/v3/",this.selector=null,this.init=function(t,e,s,i){var a=this;if("string"!=typeof t||"string"!=typeof e||"string"!=typeof s)return!1;this.selector=t,this.apiKey=e,this.host=s,this.setOptions(i),this.getRequest(),this.options.realtime&&window.setInterval(function(){a.getRequest()},3e3)},this.setOptions=function(t){var e={count:10,realtime:!0,type:"Live - Top Pages",title:"Concurrent Users / Top Pages"};for(var s in t=t||{},e)e.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(t[s]=e[s]);t.realtime||"Concurrent Users / Top Pages"!==t.title||(t.title="Current Top Pages"),this.options=t},this.buildUrl=function(){return this.base+this.path+"?apikey="+this.apiKey+"&host="+this.host},this.getRequest=function(){var t=this,e=this.buildUrl(),s=new XMLHttpRequest;s.open("GET",e),s.onload=function(){200===s.status?(t.data=JSON.parse(s.responseText),t.displayResults()):alert("Request failed.  Returned status of "+s.status)},s.send()},this.displayResults=function(){if("Live - Top Pages"===this.options.type){this.templateListItem();var t="<div>"+this.createList().join("")+"</div>",e=this.options.realtime?"":"static";widgetTitle=this.options.title?'<h3 class="widget-title">'+this.options.title+"</h3>":"",widget='<div class="zl-chartbeat-widget '+e+'">'+widgetTitle+t+"</div>",document.getElementById(this.selector).innerHTML=widget}},this.createList=function(){var e=0,s=this,i=[],a="";return this.data.pages.forEach(function(t){e<s.options.count&&(a=t.title.replace(/\|.*/,""),i.push(s.templateListItem().replace(/{{path}}/g,t.path).replace(/{{people}}/g,t.stats.people).replace(/{{title}}/g,a)),e++)}),i},this.templateListItem=function(){return'<a href="https://www.{{path}}" class="row" target="_blank">'+(this.options.realtime?'<span class="cell people">{{people}}</span>':"")+'<span class="cell title">{{title}}</span></a>'}}